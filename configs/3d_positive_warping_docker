FROM tensorflow/tensorflow:1.14.0-gpu-py3
RUN DEBIAN_FRONTEND=noninteractive apt-get update
run DEBIAN_FRONTEND=noninteractive apt-get install -y git protobuf-compiler python3-pil python3-matplotlib python3-pip
RUN pip install connected-components-3d --no-binary :all:
run git clone --single-branch --branch dev https://github.com/yoshihikoueno/DNNCancerAnnotator
workdir DNNCancerAnnotator
RUN protoc protos/*.proto --python_out=.
CMD python3 -m runs.train\
    --pipeline_config_file /kw_resources/configs/3d_positive_warping.config\
    --result_dir /kw_resources/results/annotation/3d/3d_positive_warping\
    --num_train_steps 200000

# CMD python3 -m runs.eval\
#     --checkpoint_dir /kw_resources/results/annotation/3d/3d_positive_warping\
#     --all_checkpoints --use_gpu
# #    --split_name val --eval_checkpoint_step_interval 3000 --eval_name normalized
